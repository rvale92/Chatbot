{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{marked}from'marked';// IMPORTANT: Replace this URL with your actual n8n webhook URL\n// It should look something like: https://your-n8n-instance.com/webhook/xyz...\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const N8N_WEBHOOK_URL=\"https://1590-104-208-219-243.ngrok-free.app/webhook/f3eebdec-85ac-4968-9d80-26e06d02afa4\";export const AiTutor=()=>{const[isOpen,setIsOpen]=useState(false);const[messages,setMessages]=useState([{sender:'AI Tutor',text:'Hello! I\\'m your AI tutor. How can I help you study today?',isUser:false}]);const[inputText,setInputText]=useState('');const[isSending,setIsSending]=useState(false);const chatOutputRef=useRef(null);useEffect(()=>{// Scroll to bottom whenever messages change\nif(chatOutputRef.current){chatOutputRef.current.scrollTop=chatOutputRef.current.scrollHeight;}},[messages]);const appendMessage=(sender,text,isUser)=>{setMessages(prev=>[...prev,{sender,text,isUser}]);};const sendMessage=async()=>{const userText=inputText.trim();if(userText===''||isSending)return;setInputText('');setIsSending(true);appendMessage('You',userText,true);try{const response=await fetch(N8N_WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:userText})});if(!response.ok){const errorData=await response.json().catch(()=>({message:'Unknown error'}));throw new Error(errorData.error||\"HTTP error! Status: \".concat(response.status,\" - \").concat(errorData.message||'Server error'));}const data=await response.json();if(data.response){appendMessage('AI Tutor',data.response,false);}else{appendMessage('AI Tutor',\"I received an empty or unexpected response. Please try rephrasing your question.\",false);console.warn('Unexpected response structure from n8n:',data);}}catch(error){console.error('Error communicating with AI Tutor:',error);appendMessage('AI Tutor',\"Sorry, I'm having trouble right now: \".concat(error instanceof Error?error.message:'Unknown error',\". Please check your internet connection or try again later.\"),false);}finally{setIsSending(false);}};const handleKeyPress=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed bottom-4 right-4 z-50 bg-white rounded-lg shadow-lg overflow-hidden flex flex-col w-full max-w-sm transition-all duration-300 ease-in-out \".concat(isOpen?'h-[400px] opacity-100 translate-y-0':'h-0 opacity-0 translate-y-full'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-600 text-white p-3 font-bold rounded-t-lg flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"AI Tutor\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsOpen(!isOpen),className:\"text-white hover:text-gray-200 focus:outline-none\",children:isOpen?/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})}):/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})})})]}),/*#__PURE__*/_jsx(\"div\",{ref:chatOutputRef,className:\"flex-1 p-4 overflow-y-auto bg-gray-50 text-sm\",children:messages.map((msg,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"p-2 my-1 rounded-lg max-w-[80%] \".concat(msg.isUser?'self-end bg-blue-100 text-blue-800 ml-auto':'self-start bg-gray-200 text-gray-800 mr-auto'),dangerouslySetInnerHTML:{__html:\"<strong>\".concat(msg.sender,\":</strong> \").concat(msg.isUser?msg.text:marked(msg.text))}},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 border-t border-gray-200 flex\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:inputText,onChange:e=>setInputText(e.target.value),onKeyPress:handleKeyPress,className:\"flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"Ask me a question...\",disabled:isSending}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,disabled:isSending,className:\"ml-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out disabled:opacity-50\",children:\"Send\"})]})]});};export default AiTutor;","map":{"version":3,"names":["React","useEffect","useRef","useState","marked","jsx","_jsx","jsxs","_jsxs","N8N_WEBHOOK_URL","AiTutor","isOpen","setIsOpen","messages","setMessages","sender","text","isUser","inputText","setInputText","isSending","setIsSending","chatOutputRef","current","scrollTop","scrollHeight","appendMessage","prev","sendMessage","userText","trim","response","fetch","method","headers","body","JSON","stringify","prompt","ok","errorData","json","catch","message","Error","error","concat","status","data","console","warn","handleKeyPress","e","key","shiftKey","preventDefault","className","children","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","ref","map","msg","index","dangerouslySetInnerHTML","__html","type","value","onChange","target","onKeyPress","placeholder","disabled"],"sources":["/Users/reimundovalentin/Downloads/ai-tutor-project/src/components/AiTutor.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { marked } from 'marked';\n\n// IMPORTANT: Replace this URL with your actual n8n webhook URL\n// It should look something like: https://your-n8n-instance.com/webhook/xyz...\nconst N8N_WEBHOOK_URL = \"https://1590-104-208-219-243.ngrok-free.app/webhook/f3eebdec-85ac-4968-9d80-26e06d02afa4\";\n\ninterface Message {\n    sender: string;\n    text: string;\n    isUser: boolean;\n}\n\nexport const AiTutor: React.FC = () => {\n    const [isOpen, setIsOpen] = useState(false);\n    const [messages, setMessages] = useState<Message[]>([{\n        sender: 'AI Tutor',\n        text: 'Hello! I\\'m your AI tutor. How can I help you study today?',\n        isUser: false\n    }]);\n    const [inputText, setInputText] = useState('');\n    const [isSending, setIsSending] = useState(false);\n    const chatOutputRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        // Scroll to bottom whenever messages change\n        if (chatOutputRef.current) {\n            chatOutputRef.current.scrollTop = chatOutputRef.current.scrollHeight;\n        }\n    }, [messages]);\n\n    const appendMessage = (sender: string, text: string, isUser: boolean) => {\n        setMessages(prev => [...prev, { sender, text, isUser }]);\n    };\n\n    const sendMessage = async () => {\n        const userText = inputText.trim();\n        if (userText === '' || isSending) return;\n\n        setInputText('');\n        setIsSending(true);\n        appendMessage('You', userText, true);\n\n        try {\n            const response = await fetch(N8N_WEBHOOK_URL, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({ prompt: userText })\n            });\n\n            if (!response.ok) {\n                const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));\n                throw new Error(errorData.error || `HTTP error! Status: ${response.status} - ${errorData.message || 'Server error'}`);\n            }\n\n            const data = await response.json();\n            if (data.response) {\n                appendMessage('AI Tutor', data.response, false);\n            } else {\n                appendMessage('AI Tutor', \"I received an empty or unexpected response. Please try rephrasing your question.\", false);\n                console.warn('Unexpected response structure from n8n:', data);\n            }\n        } catch (error) {\n            console.error('Error communicating with AI Tutor:', error);\n            appendMessage('AI Tutor', `Sorry, I'm having trouble right now: ${error instanceof Error ? error.message : 'Unknown error'}. Please check your internet connection or try again later.`, false);\n        } finally {\n            setIsSending(false);\n        }\n    };\n\n    const handleKeyPress = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            sendMessage();\n        }\n    };\n\n    return (\n        <div className={`fixed bottom-4 right-4 z-50 bg-white rounded-lg shadow-lg overflow-hidden flex flex-col w-full max-w-sm transition-all duration-300 ease-in-out ${\n            isOpen ? 'h-[400px] opacity-100 translate-y-0' : 'h-0 opacity-0 translate-y-full'\n        }`}>\n            {/* Chat Header */}\n            <div className=\"bg-blue-600 text-white p-3 font-bold rounded-t-lg flex justify-between items-center\">\n                <span>AI Tutor</span>\n                <button \n                    onClick={() => setIsOpen(!isOpen)}\n                    className=\"text-white hover:text-gray-200 focus:outline-none\"\n                >\n                    {isOpen ? (\n                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                        </svg>\n                    ) : (\n                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                        </svg>\n                    )}\n                </button>\n            </div>\n\n            {/* Chat Output Area */}\n            <div ref={chatOutputRef} className=\"flex-1 p-4 overflow-y-auto bg-gray-50 text-sm\">\n                {messages.map((msg, index) => (\n                    <div\n                        key={index}\n                        className={`p-2 my-1 rounded-lg max-w-[80%] ${\n                            msg.isUser\n                                ? 'self-end bg-blue-100 text-blue-800 ml-auto'\n                                : 'self-start bg-gray-200 text-gray-800 mr-auto'\n                        }`}\n                        dangerouslySetInnerHTML={{\n                            __html: `<strong>${msg.sender}:</strong> ${msg.isUser ? msg.text : marked(msg.text)}`\n                        }}\n                    />\n                ))}\n            </div>\n\n            {/* Chat Input Area */}\n            <div className=\"p-3 border-t border-gray-200 flex\">\n                <input\n                    type=\"text\"\n                    value={inputText}\n                    onChange={(e) => setInputText(e.target.value)}\n                    onKeyPress={handleKeyPress}\n                    className=\"flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    placeholder=\"Ask me a question...\"\n                    disabled={isSending}\n                />\n                <button\n                    onClick={sendMessage}\n                    disabled={isSending}\n                    className=\"ml-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out disabled:opacity-50\"\n                >\n                    Send\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default AiTutor;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}